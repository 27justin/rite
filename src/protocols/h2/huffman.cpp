#include "protocols/h2/huffman.hpp"
#include "protocols/h2/hpack.hpp"

huffman &
h2::hpack::decoder() {
    static huffman::encoding_map HPACK_ENCODING = {
        { 0, { 0b1111111111000, 13 } },
        { 1, { 0b11111111111111111011000, 23 } },
        { 2, { 0b1111111111111111111111100010, 28 } },
        { 3, { 0b1111111111111111111111100011, 28 } },
        { 4, { 0b1111111111111111111111100100, 28 } },
        { 5, { 0b1111111111111111111111100101, 28 } },
        { 6, { 0b1111111111111111111111100110, 28 } },
        { 7, { 0b1111111111111111111111100111, 28 } },
        { 8, { 0b1111111111111111111111101000, 28 } },
        { 9, { 0b111111111111111111101010, 24 } },
        { 10, { 0b111111111111111111111111111100, 30 } },
        { 11, { 0b1111111111111111111111101001, 28 } },
        { 12, { 0b1111111111111111111111101010, 28 } },
        { 13, { 0b111111111111111111111111111101, 30 } },
        { 14, { 0b1111111111111111111111101011, 28 } },
        { 15, { 0b1111111111111111111111101100, 28 } },
        { 16, { 0b1111111111111111111111101101, 28 } },
        { 17, { 0b1111111111111111111111101110, 28 } },
        { 18, { 0b1111111111111111111111101111, 28 } },
        { 19, { 0b1111111111111111111111110000, 28 } },
        { 20, { 0b1111111111111111111111110001, 28 } },
        { 21, { 0b1111111111111111111111110010, 28 } },
        { 22, { 0b111111111111111111111111111110, 30 } },
        { 23, { 0b1111111111111111111111110011, 28 } },
        { 24, { 0b1111111111111111111111110100, 28 } },
        { 25, { 0b1111111111111111111111110101, 28 } },
        { 26, { 0b1111111111111111111111110110, 28 } },
        { 27, { 0b1111111111111111111111110111, 28 } },
        { 28, { 0b1111111111111111111111111000, 28 } },
        { 29, { 0b1111111111111111111111111001, 28 } },
        { 30, { 0b1111111111111111111111111010, 28 } },
        { 31, { 0b1111111111111111111111111011, 28 } },
        { 32, { 0b010100, 6 } },
        { 33, { 0b1111111000, 10 } },
        { 34, { 0b1111111001, 10 } },
        { 35, { 0b111111111010, 12 } },
        { 36, { 0b1111111111001, 13 } },
        { 37, { 0b010101, 6 } },
        { 38, { 0b11111000, 8 } },
        { 39, { 0b11111111010, 11 } },
        { 40, { 0b1111111010, 10 } },
        { 41, { 0b1111111011, 10 } },
        { 42, { 0b11111001, 8 } },
        { 43, { 0b11111111011, 11 } },
        { 44, { 0b11111010, 8 } },
        { 45, { 0b010110, 6 } },
        { 46, { 0b010111, 6 } },
        { 47, { 0b011000, 6 } },
        { 48, { 0b00000, 5 } },
        { 49, { 0b00001, 5 } },
        { 50, { 0b00010, 5 } },
        { 51, { 0b011001, 6 } },
        { 52, { 0b011010, 6 } },
        { 53, { 0b011011, 6 } },
        { 54, { 0b011100, 6 } },
        { 55, { 0b011101, 6 } },
        { 56, { 0b011110, 6 } },
        { 57, { 0b011111, 6 } },
        { 58, { 0b1011100, 7 } },
        { 59, { 0b11111011, 8 } },
        { 60, { 0b111111111111100, 15 } },
        { 61, { 0b100000, 6 } },
        { 62, { 0b111111111011, 12 } },
        { 63, { 0b1111111100, 10 } },
        { 64, { 0b1111111111010, 13 } },
        { 65, { 0b100001, 6 } },
        { 66, { 0b1011101, 7 } },
        { 67, { 0b1011110, 7 } },
        { 68, { 0b1011111, 7 } },
        { 69, { 0b1100000, 7 } },
        { 70, { 0b1100001, 7 } },
        { 71, { 0b1100010, 7 } },
        { 72, { 0b1100011, 7 } },
        { 73, { 0b1100100, 7 } },
        { 74, { 0b1100101, 7 } },
        { 75, { 0b1100110, 7 } },
        { 76, { 0b1100111, 7 } },
        { 77, { 0b1101000, 7 } },
        { 78, { 0b1101001, 7 } },
        { 79, { 0b1101010, 7 } },
        { 80, { 0b1101011, 7 } },
        { 81, { 0b1101100, 7 } },
        { 82, { 0b1101101, 7 } },
        { 83, { 0b1101110, 7 } },
        { 84, { 0b1101111, 7 } },
        { 85, { 0b1110000, 7 } },
        { 86, { 0b1110001, 7 } },
        { 87, { 0b1110010, 7 } },
        { 88, { 0b11111100, 8 } },
        { 89, { 0b1110011, 7 } },
        { 90, { 0b11111101, 8 } },
        { 91, { 0b1111111111011, 13 } },
        { 92, { 0b1111111111111110000, 19 } },
        { 93, { 0b1111111111100, 13 } },
        { 94, { 0b11111111111100, 14 } },
        { 95, { 0b100010, 6 } },
        { 96, { 0b111111111111101, 15 } },
        { 97, { 0b00011, 5 } },
        { 98, { 0b100011, 6 } },
        { 99, { 0b00100, 5 } },
        { 100, { 0b100100, 6 } },
        { 101, { 0b00101, 5 } },
        { 102, { 0b100101, 6 } },
        { 103, { 0b100110, 6 } },
        { 104, { 0b100111, 6 } },
        { 105, { 0b00110, 5 } },
        { 106, { 0b1110100, 7 } },
        { 107, { 0b1110101, 7 } },
        { 108, { 0b101000, 6 } },
        { 109, { 0b101001, 6 } },
        { 110, { 0b101010, 6 } },
        { 111, { 0b00111, 5 } },
        { 112, { 0b101011, 6 } },
        { 113, { 0b1110110, 7 } },
        { 114, { 0b101100, 6 } },
        { 115, { 0b01000, 5 } },
        { 116, { 0b01001, 5 } },
        { 117, { 0b101101, 6 } },
        { 118, { 0b1110111, 7 } },
        { 119, { 0b1111000, 7 } },
        { 120, { 0b1111001, 7 } },
        { 121, { 0b1111010, 7 } },
        { 122, { 0b1111011, 7 } },
        { 123, { 0b111111111111110, 15 } },
        { 124, { 0b11111111100, 11 } },
        { 125, { 0b11111111111101, 14 } },
        { 126, { 0b1111111111101, 13 } },
        { 127, { 0b1111111111111111111111111100, 28 } },
        { 128, { 0b11111111111111100110, 20 } },
        { 129, { 0b1111111111111111010010, 22 } },
        { 130, { 0b11111111111111100111, 20 } },
        { 131, { 0b11111111111111101000, 20 } },
        { 132, { 0b1111111111111111010011, 22 } },
        { 133, { 0b1111111111111111010100, 22 } },
        { 134, { 0b1111111111111111010101, 22 } },
        { 135, { 0b11111111111111111011001, 23 } },
        { 136, { 0b1111111111111111010110, 22 } },
        { 137, { 0b11111111111111111011010, 23 } },
        { 138, { 0b11111111111111111011011, 23 } },
        { 139, { 0b11111111111111111011100, 23 } },
        { 140, { 0b11111111111111111011101, 23 } },
        { 141, { 0b11111111111111111011110, 23 } },
        { 142, { 0b111111111111111111101011, 24 } },
        { 143, { 0b11111111111111111011111, 23 } },
        { 144, { 0b111111111111111111101100, 24 } },
        { 145, { 0b111111111111111111101101, 24 } },
        { 146, { 0b1111111111111111010111, 22 } },
        { 147, { 0b11111111111111111100000, 23 } },
        { 148, { 0b111111111111111111101110, 24 } },
        { 149, { 0b11111111111111111100001, 23 } },
        { 150, { 0b11111111111111111100010, 23 } },
        { 151, { 0b11111111111111111100011, 23 } },
        { 152, { 0b11111111111111111100100, 23 } },
        { 153, { 0b111111111111111011100, 21 } },
        { 154, { 0b1111111111111111011000, 22 } },
        { 155, { 0b11111111111111111100101, 23 } },
        { 156, { 0b1111111111111111011001, 22 } },
        { 157, { 0b11111111111111111100110, 23 } },
        { 158, { 0b11111111111111111100111, 23 } },
        { 159, { 0b111111111111111111101111, 24 } },
        { 160, { 0b1111111111111111011010, 22 } },
        { 161, { 0b111111111111111011101, 21 } },
        { 162, { 0b11111111111111101001, 20 } },
        { 163, { 0b1111111111111111011011, 22 } },
        { 164, { 0b1111111111111111011100, 22 } },
        { 165, { 0b11111111111111111101000, 23 } },
        { 166, { 0b11111111111111111101001, 23 } },
        { 167, { 0b111111111111111011110, 21 } },
        { 168, { 0b11111111111111111101010, 23 } },
        { 169, { 0b1111111111111111011101, 22 } },
        { 170, { 0b1111111111111111011110, 22 } },
        { 171, { 0b111111111111111111110000, 24 } },
        { 172, { 0b111111111111111011111, 21 } },
        { 173, { 0b1111111111111111011111, 22 } },
        { 174, { 0b11111111111111111101011, 23 } },
        { 175, { 0b11111111111111111101100, 23 } },
        { 176, { 0b111111111111111100000, 21 } },
        { 177, { 0b111111111111111100001, 21 } },
        { 178, { 0b1111111111111111100000, 22 } },
        { 179, { 0b111111111111111100010, 21 } },
        { 180, { 0b11111111111111111101101, 23 } },
        { 181, { 0b1111111111111111100001, 22 } },
        { 182, { 0b11111111111111111101110, 23 } },
        { 183, { 0b11111111111111111101111, 23 } },
        { 184, { 0b11111111111111101010, 20 } },
        { 185, { 0b1111111111111111100010, 22 } },
        { 186, { 0b1111111111111111100011, 22 } },
        { 187, { 0b1111111111111111100100, 22 } },
        { 188, { 0b11111111111111111110000, 23 } },
        { 189, { 0b1111111111111111100101, 22 } },
        { 190, { 0b1111111111111111100110, 22 } },
        { 191, { 0b11111111111111111110001, 23 } },
        { 192, { 0b11111111111111111111100000, 26 } },
        { 193, { 0b11111111111111111111100001, 26 } },
        { 194, { 0b11111111111111101011, 20 } },
        { 195, { 0b1111111111111110001, 19 } },
        { 196, { 0b1111111111111111100111, 22 } },
        { 197, { 0b11111111111111111110010, 23 } },
        { 198, { 0b1111111111111111101000, 22 } },
        { 199, { 0b1111111111111111111101100, 25 } },
        { 200, { 0b11111111111111111111100010, 26 } },
        { 201, { 0b11111111111111111111100011, 26 } },
        { 202, { 0b11111111111111111111100100, 26 } },
        { 203, { 0b111111111111111111111011110, 27 } },
        { 204, { 0b111111111111111111111011111, 27 } },
        { 205, { 0b11111111111111111111100101, 26 } },
        { 206, { 0b111111111111111111110001, 24 } },
        { 207, { 0b1111111111111111111101101, 25 } },
        { 208, { 0b1111111111111110010, 19 } },
        { 209, { 0b111111111111111100011, 21 } },
        { 210, { 0b11111111111111111111100110, 26 } },
        { 211, { 0b111111111111111111111100000, 27 } },
        { 212, { 0b111111111111111111111100001, 27 } },
        { 213, { 0b11111111111111111111100111, 26 } },
        { 214, { 0b111111111111111111111100010, 27 } },
        { 215, { 0b111111111111111111110010, 24 } },
        { 216, { 0b111111111111111100100, 21 } },
        { 217, { 0b111111111111111100101, 21 } },
        { 218, { 0b11111111111111111111101000, 26 } },
        { 219, { 0b11111111111111111111101001, 26 } },
        { 220, { 0b1111111111111111111111111101, 28 } },
        { 221, { 0b111111111111111111111100011, 27 } },
        { 222, { 0b111111111111111111111100100, 27 } },
        { 223, { 0b111111111111111111111100101, 27 } },
        { 224, { 0b11111111111111101100, 20 } },
        { 225, { 0b111111111111111111110011, 24 } },
        { 226, { 0b11111111111111101101, 20 } },
        { 227, { 0b111111111111111100110, 21 } },
        { 228, { 0b1111111111111111101001, 22 } },
        { 229, { 0b111111111111111100111, 21 } },
        { 230, { 0b111111111111111101000, 21 } },
        { 231, { 0b11111111111111111110011, 23 } },
        { 232, { 0b1111111111111111101010, 22 } },
        { 233, { 0b1111111111111111101011, 22 } },
        { 234, { 0b1111111111111111111101110, 25 } },
        { 235, { 0b1111111111111111111101111, 25 } },
        { 236, { 0b111111111111111111110100, 24 } },
        { 237, { 0b111111111111111111110101, 24 } },
        { 238, { 0b11111111111111111111101010, 26 } },
        { 239, { 0b11111111111111111110100, 23 } },
        { 240, { 0b11111111111111111111101011, 26 } },
        { 241, { 0b111111111111111111111100110, 27 } },
        { 242, { 0b11111111111111111111101100, 26 } },
        { 243, { 0b11111111111111111111101101, 26 } },
        { 244, { 0b111111111111111111111100111, 27 } },
        { 245, { 0b111111111111111111111101000, 27 } },
        { 246, { 0b111111111111111111111101001, 27 } },
        { 247, { 0b111111111111111111111101010, 27 } },
        { 248, { 0b111111111111111111111101011, 27 } },
        { 249, { 0b1111111111111111111111111110, 28 } },
        { 250, { 0b111111111111111111111101100, 27 } },
        { 251, { 0b111111111111111111111101101, 27 } },
        { 252, { 0b111111111111111111111101110, 27 } },
        { 253, { 0b111111111111111111111101111, 27 } },
        { 254, { 0b111111111111111111111110000, 27 } },
        { 255, { 0b11111111111111111111101110, 26 } },
        { 256, { 0b111111111111111111111111111111, 30 } },
    };
    static huffman *decoder = nullptr;
    if (decoder == nullptr) {
        decoder = new huffman(HPACK_ENCODING);
    }
    return *decoder;
}
